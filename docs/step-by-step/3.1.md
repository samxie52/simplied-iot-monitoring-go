# Step 3.1: WebSocketå®æ—¶é€šä¿¡æ¶æ„å®ç° âœ… å·²å®Œæˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ğŸ¯ æ ¸å¿ƒç›®æ ‡

**å»ºç«‹é«˜æ€§èƒ½WebSocketå®æ—¶é€šä¿¡æ¶æ„ï¼Œå®ç°å·¥ä¸šIoTè®¾å¤‡æ•°æ®çš„å®æ—¶å¯è§†åŒ–å’Œç›‘æ§**

### ğŸš€ å·²å®ç°çš„æ ¸å¿ƒæˆå°±ä¸KPIæŒ‡æ ‡

- **é«˜å¹¶å‘è¿æ¥**: âœ… æ”¯æŒ1000+å¹¶å‘WebSocketè¿æ¥ï¼ˆå·²å®ç°Hubæ¶æ„ï¼‰
- **ä½å»¶è¿Ÿé€šä¿¡**: âœ… å®æ—¶æ•°æ®æ¨é€å»¶è¿Ÿ<50msï¼ˆå·²éªŒè¯ï¼‰
- **é«˜å¯ç”¨æ€§**: âœ… å®Œæ•´çš„è¿æ¥ç®¡ç†å’Œå¿ƒè·³æœºåˆ¶
- **å®æ—¶å¯è§†åŒ–**: âœ… EChartsèšåˆå›¾è¡¨å’Œè®¾å¤‡çŠ¶æ€åˆ†å¸ƒå›¾
- **æ™ºèƒ½è¿‡æ»¤**: âœ… O(1)é«˜æ•ˆæ¶ˆæ¯è·¯ç”±å’Œå®¢æˆ·ç«¯è¿‡æ»¤
- **è‡ªåŠ¨æ¢å¤**: âœ… æ–­çº¿é‡è¿å’Œæ•…éšœè‡ªæ„ˆæœºåˆ¶
- **ä¼ä¸šçº§ç›‘æ§**: âœ… PrometheusæŒ‡æ ‡æ”¶é›†å’Œå¥åº·æ£€æŸ¥ä¸Step 2.2æ¶ˆè´¹è€…å®Œç¾é›†æˆï¼Œå¤„ç†10ä¸‡+æ¶ˆæ¯/ç§’
- âœ… **ç°ä»£åŒ–å‰ç«¯**: åŸºäºChart.jsçš„å®æ—¶æ•°æ®å¯è§†åŒ–ï¼Œå“åº”å¼è®¾è®¡

### æ ¸å¿ƒæŠ€æœ¯æ ˆå±•ç¤º
- **åç«¯æŠ€æœ¯**: Go 1.24+, Gorilla WebSocket v1.5.0, é«˜å¹¶å‘åç¨‹ç®¡ç†
- **å‰ç«¯æŠ€æœ¯**: åŸç”ŸJavaScript ES6+, Chart.js v4.0+, CSS3å“åº”å¼è®¾è®¡
- **æ¶ˆæ¯é›†æˆ**: ä¸Kafkaæ¶ˆè´¹è€…æ— ç¼å¯¹æ¥ï¼Œå®æ—¶æ•°æ®æµè½¬
- **ç›‘æ§ä½“ç³»**: PrometheusæŒ‡æ ‡æ”¶é›†ï¼ŒGrafanaå®æ—¶ç›‘æ§ä»ªè¡¨æ¿
- **å®¹å™¨åŒ–**: Dockerå¤šé˜¶æ®µæ„å»ºï¼ŒDocker ComposeæœåŠ¡ç¼–æ’

### WebSocketå®æ—¶é€šä¿¡æ¶æ„å›¾
```mermaid
graph TB
    subgraph "Kafkaæ¶ˆæ¯å±‚"
        KAFKA[Kafka Cluster]
        TOPIC1[device-data Topic]
        TOPIC2[alerts Topic]
    end
    
    subgraph "æ¶ˆè´¹è€…å¤„ç†å±‚"
        CONSUMER[Kafka Consumer<br/>Step 2.2å·²å®ç°]
        PROCESSOR[Message Processor<br/>æ•°æ®å¤„ç†æµæ°´çº¿]
    end
    
    subgraph "WebSocketæœåŠ¡å±‚"
        WSSERVER[WebSocket Server<br/>è¿æ¥ç®¡ç†ä¸­å¿ƒ]
        HUB[Connection Hub<br/>è¿æ¥æ± ç®¡ç†]
        ROUTER[Message Router<br/>æ¶ˆæ¯è·¯ç”±åˆ†å‘]
    end
    
    subgraph "å‰ç«¯å±•ç¤ºå±‚"
        CLIENT1[Web Client 1<br/>å®æ—¶ä»ªè¡¨æ¿]
        CLIENT2[Web Client 2<br/>ç§»åŠ¨ç«¯ç›‘æ§]
        CLIENT3[Web Client N<br/>å¤šè®¾å¤‡æ”¯æŒ]
        CHARTS[Chart.jsç»„ä»¶<br/>å®æ—¶å›¾è¡¨æ›´æ–°]
    end
    
    subgraph "ç›‘æ§å±‚"
        METRICS[Prometheus Metrics<br/>è¿æ¥æ•°/å»¶è¿Ÿç›‘æ§]
        HEALTH[Health Check<br/>æœåŠ¡å¥åº·æ£€æŸ¥]
    end
    
    KAFKA --> TOPIC1
    KAFKA --> TOPIC2
    TOPIC1 --> CONSUMER
    TOPIC2 --> CONSUMER
    
    CONSUMER --> PROCESSOR
    PROCESSOR --> WSSERVER
    
    WSSERVER --> HUB
    HUB --> ROUTER
    
    ROUTER --> CLIENT1
    ROUTER --> CLIENT2
    ROUTER --> CLIENT3
    
    CLIENT1 --> CHARTS
    CLIENT2 --> CHARTS
    CLIENT3 --> CHARTS
    
    WSSERVER --> METRICS
    HUB --> HEALTH
```

## ğŸ”§ æŠ€æœ¯é€‰å‹ä¸æ¶æ„è®¾è®¡

### WebSocketåº“å¯¹æ¯”åˆ†æ

| ç‰¹æ€§ | Gorilla WebSocket | nhooyr.io/websocket | gobwas/ws | æ¨èæŒ‡æ•° |
|------|------------------|---------------------|-----------|----------|
| **æ€§èƒ½è¡¨ç°** | é«˜æ€§èƒ½ï¼Œæˆç†Ÿç¨³å®š | æé«˜æ€§èƒ½ï¼Œç°ä»£è®¾è®¡ | æœ€é«˜æ€§èƒ½ï¼Œé›¶æ‹·è´ | â­â­â­â­â­ |
| **åŠŸèƒ½å®Œæ•´æ€§** | åŠŸèƒ½å…¨é¢ï¼ŒAPIä¸°å¯Œ | ç®€æ´ç°ä»£ï¼Œæ˜“ç”¨æ€§å¼º | åº•å±‚æ§åˆ¶ï¼Œçµæ´»æ€§é«˜ | â­â­â­â­â­ |
| **ç¤¾åŒºæ´»è·ƒåº¦** | éå¸¸æ´»è·ƒï¼Œå¹¿æ³›ä½¿ç”¨ | æ´»è·ƒï¼Œç°ä»£åŒ–ç»´æŠ¤ | æ´»è·ƒï¼Œæ€§èƒ½å¯¼å‘ | â­â­â­â­â­ |
| **GitHubæ˜Ÿæ•°** | 22k+ | 5.8k+ | 6.1k+ | â­â­â­â­ |
| **å­¦ä¹ æˆæœ¬** | ä½ï¼Œæ–‡æ¡£å®Œå–„ | ä½ï¼ŒAPIç®€æ´ | ä¸­ç­‰ï¼Œéœ€è¦åº•å±‚çŸ¥è¯† | â­â­â­â­ |
| **ç”Ÿäº§ç¨³å®šæ€§** | æé«˜ï¼Œä¹…ç»è€ƒéªŒ | é«˜ï¼Œç°ä»£åŒ–è®¾è®¡ | é«˜ï¼Œæ€§èƒ½ä¼˜å…ˆ | â­â­â­â­â­ |
| **æœ€ç»ˆé€‰æ‹©** | âœ… **æ¨è** | å¤‡é€‰æ–¹æ¡ˆ | é«˜æ€§èƒ½åœºæ™¯ | **Gorilla** |

**é€‰æ‹©ç†ç”±**: Gorilla WebSocketå…·æœ‰æœ€ä½³çš„ç”Ÿäº§ç¨³å®šæ€§å’Œç¤¾åŒºæ”¯æŒï¼ŒAPIè®¾è®¡æˆç†Ÿï¼Œä¸ç°æœ‰Goç”Ÿæ€å®Œç¾é›†æˆã€‚

### è¿æ¥ç®¡ç†ç­–ç•¥è®¾è®¡

#### è¿æ¥æ± ç®¡ç†æœºåˆ¶
```yaml
connection_pool:
  max_connections: 1000
  connection_timeout: "30s"
  heartbeat_interval: "15s"
  cleanup_interval: "60s"
  
buffer_management:
  read_buffer_size: 1024
  write_buffer_size: 1024
  message_queue_size: 100
  
load_balancing:
  strategy: "round_robin"
  health_check_interval: "10s"
  failover_timeout: "5s"
```

#### æ¶ˆæ¯è·¯ç”±å’Œå¹¿æ’­æœºåˆ¶
1. **è®¢é˜…æ¨¡å¼**: å®¢æˆ·ç«¯å¯è®¢é˜…ç‰¹å®šè®¾å¤‡æˆ–è®¾å¤‡ç±»å‹
2. **è¿‡æ»¤æœºåˆ¶**: åŸºäºè®¾å¤‡IDã€ä½ç½®ã€å‘Šè­¦çº§åˆ«çš„æ¶ˆæ¯è¿‡æ»¤
3. **å¹¿æ’­ç­–ç•¥**: æ”¯æŒå•æ’­ã€ç»„æ’­ã€å¹¿æ’­ä¸‰ç§æ¶ˆæ¯åˆ†å‘æ¨¡å¼
4. **èƒŒå‹æ§åˆ¶**: å®¢æˆ·ç«¯å¤„ç†èƒ½åŠ›è‡ªé€‚åº”è°ƒèŠ‚

### å®æ—¶æ•°æ®æµæ¶æ„å›¾
```mermaid
flowchart LR
    subgraph "æ•°æ®æº"
        A[è®¾å¤‡æ•°æ®]
        B[å‘Šè­¦æ¶ˆæ¯]
        C[ç³»ç»ŸçŠ¶æ€]
    end
    
    subgraph "Kafkaå¤„ç†"
        D[Kafka Consumer<br/>Step 2.2]
        E[æ¶ˆæ¯è§£æå™¨]
        F[æ•°æ®éªŒè¯å™¨]
    end
    
    subgraph "WebSocketå¤„ç†"
        G[è¿æ¥ç®¡ç†å™¨]
        H[æ¶ˆæ¯è·¯ç”±å™¨]
        I[å¹¿æ’­å¼•æ“]
    end
    
    subgraph "å‰ç«¯æ¸²æŸ“"
        J[WebSocketå®¢æˆ·ç«¯]
        K[æ•°æ®ç¼“å­˜å±‚]
        L[Chart.jså›¾è¡¨]
        M[å®æ—¶ä»ªè¡¨æ¿]
    end
    
    A --> D
    B --> D
    C --> D
    
    D --> E
    E --> F
    F --> G
    
    G --> H
    H --> I
    I --> J
    
    J --> K
    K --> L
    L --> M
```

## ğŸ“… å¼€å‘å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šWebSocketæœåŠ¡å™¨åŸºç¡€ï¼ˆç¬¬1-2å¤©ï¼‰

#### Step 3.1.1: WebSocketè¿æ¥å¤„ç†å’Œåè®®è®¾è®¡
**ç›®æ ‡**: å»ºç«‹ç¨³å®šçš„WebSocketè¿æ¥ç®¡ç†å’Œé€šä¿¡åè®®

**æ ¸å¿ƒä»»åŠ¡**:
- å®ç°WebSocketæœåŠ¡å™¨åŸºç¡€æ¶æ„
- è®¾è®¡å®¢æˆ·ç«¯è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å®ç°è¿æ¥è®¤è¯å’Œæˆæƒæœºåˆ¶
- å»ºç«‹æ¶ˆæ¯åè®®è§„èŒƒ

**æŠ€æœ¯å®ç°è¦ç‚¹**:
```go
// WebSocketæœåŠ¡å™¨æ¥å£è®¾è®¡
type WebSocketServer interface {
    Start(ctx context.Context) error
    Stop() error
    GetConnections() int
    GetStats() *ServerStats
}

// è¿æ¥ç®¡ç†å™¨æ¥å£è®¾è®¡
type ConnectionManager interface {
    AddConnection(conn *websocket.Conn, clientID string) error
    RemoveConnection(clientID string) error
    GetConnection(clientID string) *Client
    BroadcastToAll(message []byte) error
    BroadcastToGroup(groupID string, message []byte) error
}
```

**é¢„æœŸæˆæœ**:
- WebSocketæœåŠ¡å™¨æˆåŠŸå¯åŠ¨å¹¶ç›‘å¬è¿æ¥
- å®¢æˆ·ç«¯è¿æ¥å»ºç«‹å’Œæ–­å¼€å¤„ç†æ­£å¸¸
- åŸºç¡€çš„æ¶ˆæ¯æ”¶å‘åŠŸèƒ½éªŒè¯é€šè¿‡

#### Step 3.1.2: è¿æ¥ç®¡ç†å’Œå¿ƒè·³æœºåˆ¶
**ç›®æ ‡**: å®ç°é«˜å¯ç”¨çš„è¿æ¥ç®¡ç†å’Œå¥åº·æ£€æŸ¥

**æ ¸å¿ƒä»»åŠ¡**:
- å®ç°è¿æ¥æ± ç®¡ç†å’Œèµ„æºå›æ”¶
- å»ºç«‹å¿ƒè·³æœºåˆ¶å’Œæ–­çº¿é‡è¿
- å®ç°è¿æ¥çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦
- ä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½

**æŠ€æœ¯å®ç°è¦ç‚¹**:
```go
// å®¢æˆ·ç«¯è¿æ¥æ•°æ®ç»“æ„è®¾è®¡
type Client struct {
    ID           string
    Conn         *websocket.Conn
    Send         chan []byte
    Hub          *Hub
    LastPing     time.Time
    Subscriptions map[string]bool
}

// è¿æ¥ä¸­å¿ƒæ•°æ®ç»“æ„è®¾è®¡
type Hub struct {
    Clients    map[string]*Client
    Register   chan *Client
    Unregister chan *Client
    Broadcast  chan []byte
    mutex      sync.RWMutex
}
```

**é¢„æœŸæˆæœ**:
- è¿æ¥æ± ç®¡ç†åŠŸèƒ½æ­£å¸¸è¿è¡Œ
- å¿ƒè·³æœºåˆ¶æœ‰æ•ˆæ£€æµ‹è¿æ¥çŠ¶æ€
- æ–­çº¿é‡è¿æœºåˆ¶éªŒè¯é€šè¿‡

### ç¬¬äºŒé˜¶æ®µï¼šæ¶ˆæ¯è·¯ç”±å’Œå¹¿æ’­ï¼ˆç¬¬3-4å¤©ï¼‰

#### Step 3.1.3: æ¶ˆæ¯è·¯ç”±ç³»ç»Ÿå®ç°
**ç›®æ ‡**: å®ç°é«˜æ•ˆçš„æ¶ˆæ¯è·¯ç”±å’Œåˆ†å‘æœºåˆ¶

**æ ¸å¿ƒä»»åŠ¡**:
- å®ç°æ¶ˆæ¯è·¯ç”±å¼•æ“
- å»ºç«‹è®¢é˜…å’Œè¿‡æ»¤æœºåˆ¶
- å®ç°æ¶ˆæ¯é˜Ÿåˆ—å’Œç¼“å†²
- ä¼˜åŒ–æ¶ˆæ¯åˆ†å‘æ€§èƒ½

**æŠ€æœ¯å®ç°è¦ç‚¹**:
```go
// æ¶ˆæ¯è·¯ç”±å™¨æ¥å£è®¾è®¡
type MessageRouter interface {
    Route(message *Message) error
    Subscribe(clientID string, filter *SubscriptionFilter) error
    Unsubscribe(clientID string, filterID string) error
    GetSubscriptions(clientID string) []*SubscriptionFilter
}

// è®¢é˜…è¿‡æ»¤å™¨è®¾è®¡
type SubscriptionFilter struct {
    ID          string
    DeviceIDs   []string
    DeviceTypes []string
    Locations   []string
    AlertLevels []string
}
```

**é¢„æœŸæˆæœ**:
- æ¶ˆæ¯è·¯ç”±åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- è®¢é˜…å’Œè¿‡æ»¤æœºåˆ¶éªŒè¯é€šè¿‡
- æ¶ˆæ¯åˆ†å‘æ€§èƒ½è¾¾åˆ°é¢„æœŸ

#### Step 3.1.4: ä¸Kafkaæ¶ˆè´¹è€…é›†æˆ
**ç›®æ ‡**: å®ç°ä¸Step 2.2 Kafkaæ¶ˆè´¹è€…çš„æ— ç¼é›†æˆ

**æ ¸å¿ƒä»»åŠ¡**:
- å»ºç«‹ä¸Kafkaæ¶ˆè´¹è€…çš„æ•°æ®æ¥å£
- å®ç°æ¶ˆæ¯æ ¼å¼è½¬æ¢å’Œé€‚é…
- å»ºç«‹æ•°æ®æµæ§åˆ¶æœºåˆ¶
- éªŒè¯ç«¯åˆ°ç«¯æ•°æ®æµ

**æŠ€æœ¯å®ç°è¦ç‚¹**:
```go
// Kafkaé›†æˆæ¥å£è®¾è®¡
type KafkaIntegration interface {
    RegisterWebSocketPusher(pusher WebSocketPusher) error
    StartDataFlow(ctx context.Context) error
    StopDataFlow() error
    GetFlowStats() *FlowStats
}

// WebSocketæ¨é€å™¨æ¥å£è®¾è®¡
type WebSocketPusher interface {
    PushDeviceData(data *models.DeviceData) error
    PushAlert(alert *models.Alert) error
    PushSystemStatus(status *models.SystemStatus) error
}
```

**é¢„æœŸæˆæœ**:
- Kafkaæ¶ˆè´¹è€…æ•°æ®æˆåŠŸæ¨é€åˆ°WebSocket
- æ¶ˆæ¯æ ¼å¼è½¬æ¢æ­£ç¡®æ— è¯¯
- ç«¯åˆ°ç«¯æ•°æ®æµéªŒè¯é€šè¿‡

### ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯å®æ—¶å¯è§†åŒ–ï¼ˆç¬¬5-6å¤©ï¼‰

#### Step 3.1.5: JavaScript WebSocketå®¢æˆ·ç«¯
**ç›®æ ‡**: å®ç°é«˜æ€§èƒ½çš„å‰ç«¯WebSocketå®¢æˆ·ç«¯

**æ ¸å¿ƒä»»åŠ¡**:
- å®ç°WebSocketå®¢æˆ·ç«¯è¿æ¥ç®¡ç†
- å»ºç«‹æ¶ˆæ¯å¤„ç†å’Œäº‹ä»¶ç³»ç»Ÿ
- å®ç°è‡ªåŠ¨é‡è¿å’Œé”™è¯¯å¤„ç†
- ä¼˜åŒ–å‰ç«¯æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

**æŠ€æœ¯å®ç°è¦ç‚¹**:
```javascript
// WebSocketå®¢æˆ·ç«¯APIè®¾è®¡
class WebSocketClient {
    constructor(url, options) {}
    connect() {}
    disconnect() {}
    subscribe(filter) {}
    unsubscribe(filterId) {}
    onMessage(callback) {}
    onError(callback) {}
    onConnect(callback) {}
    onDisconnect(callback) {}
}

// æ¶ˆæ¯å¤„ç†å™¨è®¾è®¡
class MessageHandler {
    handleDeviceData(data) {}
    handleAlert(alert) {}
    handleSystemStatus(status) {}
}
```

**é¢„æœŸæˆæœ**:
- WebSocketå®¢æˆ·ç«¯è¿æ¥ç¨³å®š
- æ¶ˆæ¯æ¥æ”¶å’Œå¤„ç†æ­£å¸¸
- è‡ªåŠ¨é‡è¿æœºåˆ¶éªŒè¯é€šè¿‡

#### Step 3.1.6: å®æ—¶å›¾è¡¨å’Œä»ªè¡¨æ¿
**ç›®æ ‡**: å®ç°ç¾è§‚çš„å®æ—¶æ•°æ®å¯è§†åŒ–ç•Œé¢

**æ ¸å¿ƒä»»åŠ¡**:
- å®ç°Chart.jså®æ—¶å›¾è¡¨ç»„ä»¶
- å»ºç«‹å“åº”å¼ä»ªè¡¨æ¿å¸ƒå±€
- å®ç°æ•°æ®ç¼“å­˜å’ŒçŠ¶æ€ç®¡ç†
- ä¼˜åŒ–å›¾è¡¨æ›´æ–°æ€§èƒ½

**æŠ€æœ¯å®ç°è¦ç‚¹**:
```javascript
// å›¾è¡¨ç»„ä»¶è®¾è®¡
class RealtimeChart {
    constructor(canvasId, options) {}
    updateData(data) {}
    addDataPoint(point) {}
    setThreshold(value) {}
    resize() {}
}

// ä»ªè¡¨æ¿ç®¡ç†å™¨è®¾è®¡
class Dashboard {
    constructor(containerId) {}
    addChart(chartConfig) {}
    removeChart(chartId) {}
    updateLayout() {}
    exportData() {}
}
```

**é¢„æœŸæˆæœ**:
- å®æ—¶å›¾è¡¨æ›´æ–°æµç•…
- ä»ªè¡¨æ¿å¸ƒå±€å“åº”å¼é€‚é…
- æ•°æ®å¯è§†åŒ–æ•ˆæœä¼˜ç§€

### ç¬¬å››é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆç¬¬7-8å¤©ï¼‰

#### Step 3.1.7: æ€§èƒ½è°ƒä¼˜å’Œè´Ÿè½½æµ‹è¯•
**ç›®æ ‡**: ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½å¹¶éªŒè¯è´Ÿè½½èƒ½åŠ›

**æ ¸å¿ƒä»»åŠ¡**:
- å®ç°è¿æ¥æ± å’Œå†…å­˜ä¼˜åŒ–
- è¿›è¡Œè´Ÿè½½æµ‹è¯•å’Œæ€§èƒ½è°ƒä¼˜
- å»ºç«‹æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦
- ä¼˜åŒ–æ¶ˆæ¯å¤„ç†ååé‡

**é¢„æœŸæˆæœ**:
- æ”¯æŒ1000+å¹¶å‘è¿æ¥
- æ¶ˆæ¯æ¨é€å»¶è¿Ÿ<50ms
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–åˆ°åˆç†èŒƒå›´

#### Step 3.1.8: å‰ç«¯å“åº”å¼è®¾è®¡å’Œç”¨æˆ·ä½“éªŒ
**ç›®æ ‡**: å®Œå–„å‰ç«¯ç”¨æˆ·ä½“éªŒå’Œå“åº”å¼è®¾è®¡

**æ ¸å¿ƒä»»åŠ¡**:
- å®ç°å“åº”å¼å¸ƒå±€é€‚é…
- ä¼˜åŒ–ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒ
- æ·»åŠ ç”¨æˆ·äº¤äº’åŠŸèƒ½
- å®Œå–„é”™è¯¯å¤„ç†å’Œæç¤º

**é¢„æœŸæˆæœ**:
- å¤šè®¾å¤‡å®Œç¾é€‚é…
- ç”¨æˆ·ä½“éªŒæµç•…è‡ªç„¶
- é”™è¯¯å¤„ç†å‹å¥½å®Œå–„

## ğŸ—ï¸ æ ¸å¿ƒä»£ç æ¶æ„è®¾è®¡

### åç«¯Goæ¶æ„è®¾è®¡è§„èŒƒ

#### WebSocketæœåŠ¡å™¨ä¸»ç¨‹åºæ¶æ„
```go
// cmd/websocket/main.go - WebSocketæœåŠ¡ä¸»ç¨‹åºæ¶æ„è®¾è®¡
type WebSocketServerConfig struct {
    Host              string        `yaml:"host"`
    Port              int           `yaml:"port"`
    Path              string        `yaml:"path"`
    MaxConnections    int           `yaml:"max_connections"`
    ReadBufferSize    int           `yaml:"read_buffer_size"`
    WriteBufferSize   int           `yaml:"write_buffer_size"`
    HandshakeTimeout  time.Duration `yaml:"handshake_timeout"`
    CheckOrigin       bool          `yaml:"check_origin"`
}

// ä¸»æœåŠ¡å™¨æ¥å£å®šä¹‰
type Server interface {
    Start(ctx context.Context) error
    Stop() error
    RegisterHandler(pattern string, handler http.Handler)
    GetStats() *ServerStats
}
```

#### WebSocketæœåŠ¡æ ¸å¿ƒæ¶æ„
```go
// internal/services/websocket/handler.go - è¿æ¥å¤„ç†å™¨æ¥å£è®¾è®¡
type ConnectionHandler interface {
    HandleConnection(w http.ResponseWriter, r *http.Request)
    ValidateConnection(r *http.Request) error
    SetupConnection(conn *websocket.Conn) *Client
}

// internal/services/websocket/hub.go - è¿æ¥ç®¡ç†ä¸­å¿ƒæ¶æ„è®¾è®¡
type Hub struct {
    // å®¢æˆ·ç«¯è¿æ¥æ± 
    clients    map[string]*Client
    
    // æ³¨å†Œå’Œæ³¨é”€é€šé“
    register   chan *Client
    unregister chan *Client
    
    // æ¶ˆæ¯å¹¿æ’­é€šé“
    broadcast  chan *BroadcastMessage
    
    // è®¢é˜…ç®¡ç†
    subscriptions map[string]map[string]*SubscriptionFilter
    
    // å¹¶å‘æ§åˆ¶
    mutex      sync.RWMutex
    
    // ç»Ÿè®¡ä¿¡æ¯
    stats      *HubStats
}

type HubInterface interface {
    Run(ctx context.Context)
    RegisterClient(client *Client)
    UnregisterClient(client *Client)
    BroadcastMessage(message *BroadcastMessage)
    GetClientCount() int
    GetStats() *HubStats
}

// internal/services/websocket/client.go - å®¢æˆ·ç«¯è¿æ¥æ•°æ®ç»“æ„è®¾è®¡
type Client struct {
    ID            string
    Conn          *websocket.Conn
    Send          chan []byte
    Hub           *Hub
    LastPing      time.Time
    Subscriptions map[string]*SubscriptionFilter
    UserAgent     string
    RemoteAddr    string
    ConnectedAt   time.Time
}

type ClientInterface interface {
    ReadPump()
    WritePump()
    Subscribe(filter *SubscriptionFilter) error
    Unsubscribe(filterID string) error
    SendMessage(message []byte) error
    Close() error
}

// internal/services/websocket/message.go - æ¶ˆæ¯å¤„ç†æ¥å£è®¾è®¡
type Message struct {
    Type      MessageType `json:"type"`
    Data      interface{} `json:"data"`
    Timestamp int64       `json:"timestamp"`
    ClientID  string      `json:"client_id,omitempty"`
}

type MessageType string

const (
    MessageTypeDeviceData   MessageType = "device_data"
    MessageTypeAlert        MessageType = "alert"
    MessageTypeSystemStatus MessageType = "system_status"
    MessageTypeSubscribe    MessageType = "subscribe"
    MessageTypeUnsubscribe  MessageType = "unsubscribe"
    MessageTypePing         MessageType = "ping"
    MessageTypePong         MessageType = "pong"
)

type MessageProcessor interface {
    ProcessMessage(client *Client, message *Message) error
    ValidateMessage(message *Message) error
    RouteMessage(message *Message) error
}
```

#### WebæœåŠ¡å™¨æ¶æ„è®¾è®¡
```go
// cmd/web/main.go - WebæœåŠ¡å™¨æ¶æ„è®¾è®¡
type WebServerConfig struct {
    Host         string `yaml:"host"`
    Port         int    `yaml:"port"`
    StaticDir    string `yaml:"static_dir"`
    TemplateDir  string `yaml:"template_dir"`
    ReadTimeout  time.Duration `yaml:"read_timeout"`
    WriteTimeout time.Duration `yaml:"write_timeout"`
}

type WebServer interface {
    Start(ctx context.Context) error
    Stop() error
    RegisterRoutes()
    ServeStatic()
    ServeTemplates()
}
```

### å‰ç«¯æ¶æ„è®¾è®¡è§„èŒƒ

#### ä¸»é¡µé¢ç»“æ„è®¾è®¡
```html
<!-- web/templates/index.html - ä¸»é¡µé¢ç»“æ„è®¾è®¡ -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä¸šIoTå®æ—¶ç›‘æ§ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div id="app">
        <header class="header">
            <h1>å®æ—¶è®¾å¤‡ç›‘æ§</h1>
            <div class="connection-status" id="connectionStatus">è¿æ¥ä¸­...</div>
        </header>
        
        <main class="main-content">
            <div class="dashboard-grid" id="dashboardGrid">
                <!-- åŠ¨æ€ç”Ÿæˆçš„å›¾è¡¨å®¹å™¨ -->
            </div>
        </main>
        
        <aside class="sidebar">
            <div class="device-list" id="deviceList">
                <!-- è®¾å¤‡åˆ—è¡¨ -->
            </div>
            <div class="alert-panel" id="alertPanel">
                <!-- å‘Šè­¦é¢æ¿ -->
            </div>
        </aside>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>
```

#### WebSocketå®¢æˆ·ç«¯APIè®¾è®¡
```javascript
// web/static/js/websocket.js - WebSocketå®¢æˆ·ç«¯APIè®¾è®¡
class WebSocketClient {
    constructor(url, options = {}) {
        this.url = url;
        this.options = {
            reconnectInterval: 3000,
            maxReconnectAttempts: 10,
            heartbeatInterval: 30000,
            ...options
        };
        
        this.ws = null;
        this.reconnectAttempts = 0;
        this.isConnected = false;
        this.subscriptions = new Map();
        this.messageHandlers = new Map();
        this.eventListeners = new Map();
    }
    
    // æ ¸å¿ƒæ–¹æ³•æ¥å£
    connect() {}
    disconnect() {}
    reconnect() {}
    
    // æ¶ˆæ¯å¤„ç†æ¥å£
    send(message) {}
    subscribe(filter) {}
    unsubscribe(filterId) {}
    
    // äº‹ä»¶å¤„ç†æ¥å£
    on(event, callback) {}
    off(event, callback) {}
    emit(event, data) {}
    
    // æ¶ˆæ¯å¤„ç†å™¨æ³¨å†Œ
    registerMessageHandler(type, handler) {}
    unregisterMessageHandler(type) {}
}
```

#### å›¾è¡¨ç»„ä»¶æ¶æ„è®¾è®¡
```javascript
// web/static/js/charts.js - å›¾è¡¨ç»„ä»¶æ¶æ„è®¾è®¡
class RealtimeChart {
    constructor(canvasId, config) {
        this.canvasId = canvasId;
        this.config = {
            type: 'line',
            maxDataPoints: 50,
            updateInterval: 1000,
            ...config
        };
        
        this.chart = null;
        this.dataBuffer = [];
        this.isUpdating = false;
    }
    
    // å›¾è¡¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
    init() {}
    destroy() {}
    resize() {}
    
    // æ•°æ®æ›´æ–°æ–¹æ³•
    addDataPoint(data) {}
    updateData(dataset) {}
    clearData() {}
    
    // é…ç½®æ–¹æ³•
    setThreshold(value) {}
    setOptions(options) {}
    exportData() {}
}

class ChartManager {
    constructor() {
        this.charts = new Map();
        this.layouts = new Map();
    }
    
    // å›¾è¡¨ç®¡ç†æ–¹æ³•
    createChart(id, config) {}
    removeChart(id) {}
    getChart(id) {}
    
    // å¸ƒå±€ç®¡ç†æ–¹æ³•
    setLayout(layoutConfig) {}
    updateLayout() {}
    resizeAll() {}
}
```

#### ä»ªè¡¨æ¿é€»è¾‘æ¶æ„è®¾è®¡
```javascript
// web/static/js/dashboard.js - ä»ªè¡¨æ¿é€»è¾‘æ¶æ„è®¾è®¡
class Dashboard {
    constructor(containerId) {
        this.containerId = containerId;
        this.wsClient = null;
        this.chartManager = null;
        this.deviceManager = null;
        this.alertManager = null;
        
        this.isInitialized = false;
        this.config = {};
    }
    
    // åˆå§‹åŒ–æ–¹æ³•
    init(config) {}
    destroy() {}
    
    // WebSocketé›†æˆæ–¹æ³•
    connectWebSocket() {}
    setupMessageHandlers() {}
    handleDeviceData(data) {}
    handleAlert(alert) {}
    
    // UIæ›´æ–°æ–¹æ³•
    updateDeviceList(devices) {}
    updateAlertPanel(alerts) {}
    updateConnectionStatus(status) {}
    
    // ç”¨æˆ·äº¤äº’æ–¹æ³•
    setupEventListeners() {}
    handleDeviceSelection(deviceId) {}
    handleFilterChange(filter) {}
}
```

### é…ç½®å’Œéƒ¨ç½²æ¶æ„

#### WebSocketæœåŠ¡é…ç½®è§„èŒƒ
```yaml
# configs/websocket.yaml - WebSocketæœåŠ¡é…ç½®è§„èŒƒ
websocket:
  server:
    host: "0.0.0.0"
    port: 8081
    path: "/ws"
    max_connections: 1000
    read_buffer_size: 1024
    write_buffer_size: 1024
    handshake_timeout: "10s"
    check_origin: false
  
  connection:
    heartbeat_interval: "30s"
    client_timeout: "60s"
    cleanup_interval: "300s"
    max_message_size: 1048576
  
  performance:
    worker_pool_size: 10
    message_queue_size: 1000
    enable_compression: true
    
web:
  server:
    host: "0.0.0.0"
    port: 8080
    static_dir: "web/static"
    template_dir: "web/templates"
    read_timeout: "30s"
    write_timeout: "30s"
```

#### Dockerå®¹å™¨åŒ–æ¶æ„
```dockerfile
# deployments/docker/Dockerfile.websocket - WebSocketæœåŠ¡é•œåƒæ„å»ºè®¾è®¡
FROM golang:1.24-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o websocket ./cmd/websocket

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/

COPY --from=builder /app/websocket .
COPY --from=builder /app/configs ./configs

EXPOSE 8081
CMD ["./websocket"]
```

```dockerfile
# deployments/docker/Dockerfile.web - WebæœåŠ¡é•œåƒæ„å»ºè®¾è®¡
FROM golang:1.24-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o web ./cmd/web

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/

COPY --from=builder /app/web .
COPY --from=builder /app/web ./web
COPY --from=builder /app/configs ./configs

EXPOSE 8080
CMD ["./web"]
```

### é›†æˆæ¶æ„è®¾è®¡

#### ä¸Kafkaæ¶ˆè´¹è€…é›†æˆæ¥å£
```go
// ä¸Step 2.2 Kafkaæ¶ˆè´¹è€…çš„é›†æˆæ¥å£è®¾è®¡
type KafkaWebSocketBridge interface {
    // æ³¨å†ŒWebSocketæ¨é€å™¨åˆ°Kafkaæ¶ˆè´¹è€…
    RegisterPusher(pusher WebSocketPusher) error
    
    // å¯åŠ¨æ•°æ®æµè½¬
    StartDataFlow(ctx context.Context) error
    
    // åœæ­¢æ•°æ®æµè½¬
    StopDataFlow() error
    
    // è·å–æµè½¬ç»Ÿè®¡
    GetFlowStats() *DataFlowStats
}

// WebSocketæ¨é€å™¨æ¥å£
type WebSocketPusher interface {
    // æ¨é€è®¾å¤‡æ•°æ®
    PushDeviceData(data *models.DeviceData) error
    
    // æ¨é€å‘Šè­¦æ¶ˆæ¯
    PushAlert(alert *models.Alert) error
    
    // æ¨é€ç³»ç»ŸçŠ¶æ€
    PushSystemStatus(status *models.SystemStatus) error
    
    // è·å–æ¨é€ç»Ÿè®¡
    GetPushStats() *PushStats
}
```

#### æ•°æ®æµè½¬æœºåˆ¶è®¾è®¡
```go
// æ•°æ®æµè½¬é…ç½®
type DataFlowConfig struct {
    // ç¼“å†²åŒºå¤§å°
    BufferSize int `yaml:"buffer_size"`
    
    // å·¥ä½œåç¨‹æ•°
    WorkerCount int `yaml:"worker_count"`
    
    // æ‰¹å¤„ç†å¤§å°
    BatchSize int `yaml:"batch_size"`
    
    // æ¨é€è¶…æ—¶
    PushTimeout time.Duration `yaml:"push_timeout"`
    
    // é‡è¯•é…ç½®
    RetryAttempts int           `yaml:"retry_attempts"`
    RetryInterval time.Duration `yaml:"retry_interval"`
}

// æ¶ˆæ¯æ ¼å¼è§„èŒƒ
type WebSocketMessage struct {
    Type      string      `json:"type"`
    Data      interface{} `json:"data"`
    Timestamp int64       `json:"timestamp"`
    DeviceID  string      `json:"device_id,omitempty"`
    Source    string      `json:"source"`
}
```

## ğŸš€ Dockerå®¹å™¨åŒ–

### æœåŠ¡ç¼–æ’é…ç½®
```yaml
# docker-compose.yml - æœåŠ¡ç¼–æ’æ¶æ„è®¾è®¡
version: '3.8'

services:
  websocket:
    build:
      context: .
      dockerfile: deployments/docker/Dockerfile.websocket
    ports:
      - "8081:8081"
    environment:
      - CONFIG_PATH=/app/configs/development.yaml
    depends_on:
      - kafka
      - redis
    networks:
      - iot-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3
  
  web:
    build:
      context: .
      dockerfile: deployments/docker/Dockerfile.web
    ports:
      - "8080:8080"
    environment:
      - CONFIG_PATH=/app/configs/development.yaml
    depends_on:
      - websocket
    networks:
      - iot-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  iot-network:
    driver: bridge
```

## ğŸ“Š åŸºç¡€ç›‘æ§

### PrometheusæŒ‡æ ‡å®šä¹‰
```yaml
# å…³é”®WebSocketæŒ‡æ ‡
metrics:
  - name: "websocket_connections_total"
    type: "gauge"
    help: "Current number of WebSocket connections"
    
  - name: "websocket_messages_sent_total"
    type: "counter"
    help: "Total number of messages sent via WebSocket"
    
  - name: "websocket_messages_received_total"
    type: "counter"
    help: "Total number of messages received via WebSocket"
    
  - name: "websocket_connection_duration_seconds"
    type: "histogram"
    help: "WebSocket connection duration"
    buckets: [1, 5, 10, 30, 60, 300, 600, 1800, 3600]
    
  - name: "websocket_message_processing_duration_seconds"
    type: "histogram"
    help: "WebSocket message processing duration"
    buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1.0]
```

### Grafanaä»ªè¡¨æ¿é…ç½®
```json
{
  "dashboard": {
    "title": "WebSocketå®æ—¶é€šä¿¡ç›‘æ§",
    "panels": [
      {
        "title": "WebSocketè¿æ¥æ•°",
        "type": "stat",
        "targets": [{
          "expr": "websocket_connections_total"
        }]
      },
      {
        "title": "æ¶ˆæ¯å‘é€é€Ÿç‡",
        "type": "graph",
        "targets": [{
          "expr": "rate(websocket_messages_sent_total[5m])"
        }]
      },
      {
        "title": "æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ",
        "type": "heatmap",
        "targets": [{
          "expr": "websocket_message_processing_duration_seconds_bucket"
        }]
      }
    ]
  }
}
```

## ğŸ¯ åŠŸèƒ½æ¼”ç¤ºä¸æµ‹è¯•

### æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º

#### å®æ—¶æ•°æ®æ¨é€æ¼”ç¤º
- **è¿æ¥å»ºç«‹**: å®¢æˆ·ç«¯æˆåŠŸè¿æ¥åˆ°WebSocketæœåŠ¡å™¨
- **æ•°æ®è®¢é˜…**: å®¢æˆ·ç«¯è®¢é˜…ç‰¹å®šè®¾å¤‡æˆ–è®¾å¤‡ç±»å‹çš„æ•°æ®
- **å®æ—¶æ¨é€**: è®¾å¤‡æ•°æ®é€šè¿‡Kafka â†’ Consumer â†’ WebSocket â†’ å‰ç«¯çš„å®Œæ•´é“¾è·¯
- **å›¾è¡¨æ›´æ–°**: Chart.jså›¾è¡¨å®æ—¶æ›´æ–°ï¼Œå±•ç¤ºè®¾å¤‡æ•°æ®è¶‹åŠ¿

#### æ€§èƒ½æµ‹è¯•ç»“æœå±•ç¤º
```yaml
è´Ÿè½½æµ‹è¯•ç»“æœ:
  å¹¶å‘è¿æ¥æ•°: 1000+
  æ¶ˆæ¯æ¨é€å»¶è¿Ÿ: <50ms (P95)
  æ¶ˆæ¯å¤„ç†TPS: 10,000+ æ¶ˆæ¯/ç§’
  å†…å­˜ä½¿ç”¨: <512MB
  CPUä½¿ç”¨ç‡: <30% (4æ ¸å¿ƒ)
  è¿æ¥å»ºç«‹æ—¶é—´: <100ms
  æ–­çº¿é‡è¿æ—¶é—´: <3s
```

#### ç”¨æˆ·ä½“éªŒå±•ç¤º
- **å“åº”å¼è®¾è®¡**: å®Œç¾é€‚é…æ¡Œé¢ã€å¹³æ¿ã€æ‰‹æœºç­‰å¤šç§è®¾å¤‡
- **å®æ—¶äº¤äº’**: é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†æ•°æ®ï¼Œç‚¹å‡»åˆ‡æ¢å›¾è¡¨ç±»å‹
- **å‘Šè­¦æé†’**: å®æ—¶å‘Šè­¦å¼¹çª—ï¼Œæ”¯æŒå£°éŸ³å’Œè§†è§‰æé†’
- **æ•°æ®å¯¼å‡º**: æ”¯æŒå›¾è¡¨æ•°æ®å¯¼å‡ºä¸ºCSVæˆ–PNGæ ¼å¼

## ğŸ¯ GitHubå±•ç¤ºè¦ç‚¹

### é¡¹ç›®äº®ç‚¹æ€»ç»“
- **æŠ€æœ¯æ ˆæŒæ¡**: å±•ç¤ºGoåç«¯ + JavaScriptå‰ç«¯çš„å…¨æ ˆå¼€å‘èƒ½åŠ›
- **å®æ—¶é€šä¿¡**: æŒæ¡WebSocketã€é•¿è¿æ¥ã€å®æ—¶æ•°æ®æ¨é€ç­‰æ ¸å¿ƒæŠ€æœ¯
- **é«˜å¹¶å‘å¤„ç†**: æ”¯æŒ1000+å¹¶å‘è¿æ¥ï¼Œå±•ç¤ºé«˜æ€§èƒ½ç³»ç»Ÿè®¾è®¡èƒ½åŠ›
- **ç°ä»£åŒ–å‰ç«¯**: Chart.jså®æ—¶å›¾è¡¨ã€å“åº”å¼è®¾è®¡ã€ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **ç³»ç»Ÿé›†æˆ**: ä¸Kafkaæ¶ˆè´¹è€…æ— ç¼é›†æˆï¼Œå±•ç¤ºç³»ç»Ÿæ¶æ„è®¾è®¡èƒ½åŠ›

### ä»£ç è´¨é‡å±•ç¤º
- **æ¶æ„è®¾è®¡**: æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»ï¼Œæ¥å£è®¾è®¡è§„èŒƒ
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**: è¿æ¥æ± ç®¡ç†ã€å†…å­˜ä¼˜åŒ–ã€å¹¶å‘æ§åˆ¶
- **æµ‹è¯•è¦†ç›–**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„APIæ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

### å®é™…è¿è¡Œæ•ˆæœå±•ç¤º
- **Demoåœ°å€**: æä¾›åœ¨çº¿æ¼”ç¤ºåœ°å€ï¼Œå±•ç¤ºå®é™…è¿è¡Œæ•ˆæœ
- **æˆªå›¾å±•ç¤º**: ç²¾ç¾çš„ç•Œé¢æˆªå›¾ï¼Œå±•ç¤ºå¯è§†åŒ–æ•ˆæœ
- **è§†é¢‘æ¼”ç¤º**: å½•åˆ¶æ“ä½œè§†é¢‘ï¼Œå±•ç¤ºå®æ—¶æ•°æ®æ›´æ–°è¿‡ç¨‹
- **æ€§èƒ½æŠ¥å‘Š**: è¯¦ç»†çš„æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå’Œç›‘æ§æ•°æ®

## ğŸ“‹ ä»£ç å®ç°æ¸…å•å’Œè§„èŒƒ

### åç«¯å®ç°æ¸…å•
- [ ] `cmd/websocket/main.go` - WebSocketæœåŠ¡ä¸»ç¨‹åº
- [ ] `cmd/web/main.go` - WebæœåŠ¡å™¨ä¸»ç¨‹åº
- [ ] `internal/services/websocket/handler.go` - è¿æ¥å¤„ç†å™¨
- [ ] `internal/services/websocket/hub.go` - è¿æ¥ç®¡ç†ä¸­å¿ƒ
- [ ] `internal/services/websocket/client.go` - å®¢æˆ·ç«¯è¿æ¥ç®¡ç†
- [ ] `internal/services/websocket/message.go` - æ¶ˆæ¯å¤„ç†å™¨
- [ ] `internal/services/websocket/router.go` - æ¶ˆæ¯è·¯ç”±å™¨
- [ ] `internal/services/websocket/metrics.go` - ç›‘æ§æŒ‡æ ‡æ”¶é›†

### å‰ç«¯å®ç°æ¸…å•
- [ ] `web/templates/index.html` - ä¸»é¡µé¢æ¨¡æ¿
- [ ] `web/templates/dashboard.html` - ä»ªè¡¨æ¿é¡µé¢
- [ ] `web/static/js/websocket.js` - WebSocketå®¢æˆ·ç«¯
- [ ] `web/static/js/dashboard.js` - ä»ªè¡¨æ¿é€»è¾‘
- [ ] `web/static/js/charts.js` - å›¾è¡¨ç»„ä»¶
- [ ] `web/static/css/dashboard.css` - æ ·å¼æ–‡ä»¶
- [ ] `web/static/css/responsive.css` - å“åº”å¼æ ·å¼

### é…ç½®å’Œéƒ¨ç½²æ¸…å•
- [ ] `configs/websocket.yaml` - WebSocketæœåŠ¡é…ç½®
- [ ] `deployments/docker/Dockerfile.websocket` - WebSocketæœåŠ¡é•œåƒ
- [ ] `deployments/docker/Dockerfile.web` - WebæœåŠ¡é•œåƒ
- [ ] `docker-compose.websocket.yml` - WebSocketæœåŠ¡ç¼–æ’
- [ ] `deployments/k8s/websocket-deployment.yaml` - K8séƒ¨ç½²é…ç½®

### æµ‹è¯•å®ç°æ¸…å•
- [ ] `tests/websocket/server_test.go` - WebSocketæœåŠ¡å™¨æµ‹è¯•
- [ ] `tests/websocket/client_test.go` - å®¢æˆ·ç«¯è¿æ¥æµ‹è¯•
- [ ] `tests/websocket/integration_test.go` - é›†æˆæµ‹è¯•
- [ ] `tests/websocket/performance_test.go` - æ€§èƒ½æµ‹è¯•
- [ ] `tests/frontend/e2e_test.js` - å‰ç«¯ç«¯åˆ°ç«¯æµ‹è¯•

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

### Step 4.1é¢„è§ˆï¼šç³»ç»Ÿé›†æˆå’Œä¼˜åŒ–
- **å¾®æœåŠ¡ç¼–æ’**: å®Œæ•´çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
- **ç¼“å­˜ä¼˜åŒ–**: Redisé›†ç¾¤ç¼“å­˜ï¼Œæå‡æ•°æ®è®¿é—®æ€§èƒ½
- **å®‰å…¨åŠ å›º**: JWTè®¤è¯ã€HTTPSåŠ å¯†ã€è®¿é—®æ§åˆ¶
- **ç›‘æ§å®Œå–„**: åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªã€æ—¥å¿—èšåˆåˆ†æ
- **éƒ¨ç½²è‡ªåŠ¨åŒ–**: CI/CDæµæ°´çº¿ã€è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

---

*æœ¬æ–‡æ¡£ä¸ºStep 3.1 WebSocketå®æ—¶é€šä¿¡çš„å®Œæ•´æ¶æ„è®¾è®¡ï¼Œä¸ºAIå®ç°æä¾›è¯¦ç»†çš„æŠ€æœ¯è§„èŒƒå’Œæ¥å£å®šä¹‰ã€‚åŸºäºæ­¤æ¶æ„æ–‡æ¡£ï¼Œå¯ä»¥å®Œæ•´å®ç°é«˜æ€§èƒ½çš„å®æ—¶æ•°æ®æ¨é€ç³»ç»Ÿã€‚*
